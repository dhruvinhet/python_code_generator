from PIL import Image
import torch

async def process_image(pipe, prompt, height, width, num_inference_steps, guidance_scale):
    """Generates an image using the Stable Diffusion pipeline."""
    logger = logging.getLogger(__name__)
    try:
        image = pipe(prompt, height=height, width=width, num_inference_steps=num_inference_steps, guidance_scale=guidance_scale).images[0]
        return image
    except Exception as e:
        logger.error(f"Image processing failed: {e}")
        raise